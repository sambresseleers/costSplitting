<%- include('partials/header') %>

<div class="container my-4">
  <h1>Expense Report</h1>

  <div class="table-responsive">
    <table class="table table-striped table-bordered w-100">
      <thead class="table-dark">
        <tr>
          <th>Person</th>
          <th>Item</th>
          <th>Cost</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <% 
          Object.keys(reportData).forEach(person => {
            const data = reportData[person];
            data.items.forEach(item => { 
        %>
          <tr>
            <td><%= item.person %></td>
            <td><%= item.item %></td>
            <td><%= formatCurrency(item.cost) %></td>
            <td><%= item.status.charAt(0).toUpperCase() + item.status.slice(1) %></td>
            <td>
              <!-- Delete -->
              <form action="/expenses/<%= item.id %>?_method=DELETE" method="POST" style="display:inline">
                <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Delete this expense?');">Delete</button>
              </form>

              <!-- Edit -->
              <a href="/expenses/<%= item.id %>/edit" class="btn btn-sm btn-primary mx-1">Edit</a>

              <!-- Toggle Paid -->
              <form action="/expenses/<%= item.id %>/toggle-paid" method="POST" style="display:inline">
                <button type="submit" class="btn btn-sm btn-secondary">
                  <%= item.status === 'paid' ? 'Mark Unpaid' : 'Mark Paid' %>
                </button>
              </form>
            </td>
          </tr>
        <% })}) %>
      </tbody>
    </table>
  </div>

  <h2>Totals by Person</h2>
  <ul>
    <% Object.entries(reportData).forEach(([person, data]) => { %>
      <li><strong><%= person %>:</strong> <%= data.totalFormatted %></li>
    <% }) %>
  </ul>
</div>

<%- include('partials/footer') %>
